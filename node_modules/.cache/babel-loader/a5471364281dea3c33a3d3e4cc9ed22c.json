{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\tank6\\\\Desktop\\\\React\\\\brainwave_webviewer\\\\src\\\\pages\\\\CanvasGraph.js\";\nimport React from 'react';\nimport ScrollBar from './ScrollBar';\n\nclass CanvasGraph extends React.Component {\n  constructor(props) {\n    super(props);\n    this.canvasRef = /*#__PURE__*/React.createRef();\n    this.canvasContext = null;\n    this.scrollBarRef = null;\n    this.isPlaying = false;\n    this.textWidth = 100;\n    this.timelineHeight = 50; //Bind Functions\n\n    this.play = this.play.bind(this);\n    this.stop = this.stop.bind(this);\n    this.setoffset = this.setoffset.bind(this);\n    var channelCount = props.channels;\n    this.peakArray = [];\n    this.peakOffset = props.count / -2;\n    this.peakMaxOffset = 0;\n    this.peakMinOffset = props.count / -2; //Create Test Samples\n\n    var c;\n    var i;\n\n    for (c = 0; c < channelCount; c++) {\n      this.peakArray.push([]);\n\n      for (i = 0; i < 100000; i++) {\n        this.peakArray[c].push(0);\n      }\n    }\n\n    this.peakMaxOffset = this.peakArray[0].length - this.props.count / 2;\n  }\n\n  componentDidMount() {\n    this.canvasContext = this.canvasRef.current.getContext('2d', {\n      alpha: false\n    });\n    this.canvasContext.fillStyle = 'black';\n    this.canvasContext.lineWidth = 1;\n    this.canvasContext.shadowBlur = 0;\n    this.canvasContext.font = this.props.height / 2 + 'px malgun gothic';\n    this.play();\n  }\n\n  componentWillUnmount() {\n    this.stop();\n  } //Play\n\n\n  play() {\n    if (this.isPlaying) return; //Rewind\n\n    if (this.peakOffset === this.peakMaxOffset) {\n      this.peakOffset = this.peakMinOffset;\n    }\n\n    this.timer = setInterval(() => {\n      this.update();\n      this.draw();\n    }, 5);\n    this.isPlaying = true;\n    if (this.props.onPlayStateChanged !== undefined) this.props.onPlayStateChanged();\n  }\n\n  stop() {\n    if (!this.isPlaying) return;\n    if (this.timer == null) return;\n    clearInterval(this.timer);\n    this.timer = null;\n    this.isPlaying = false;\n    if (this.props.onPlayStateChanged !== undefined) this.props.onPlayStateChanged();\n  }\n\n  togglePlay() {\n    if (this.isPlaying) this.stop();else this.play();\n  } //Controls\n\n\n  setfile(file) {\n    this.currentFile = file;\n    this.peakArray = file.getNormalizedAmpData();\n    this.peakOffset = this.peakMinOffset;\n    this.peakMaxOffset = this.peakArray[0].length - this.props.count / 2;\n    this.scrollBarRef.setHandlePosition(0);\n    this.draw();\n    if (this.props.onOffsetChanged !== undefined) this.props.onOffsetChanged(0);\n  }\n\n  setoffset(pos) {\n    this.peakOffset = Math.floor((this.peakMaxOffset + this.props.count / 2) * pos) - this.props.count / 2;\n    this.draw();\n    if (this.props.onOffsetChanged !== undefined) this.props.onOffsetChanged(pos);\n  }\n\n  next() {\n    this.peakOffset += this.props.speed * 10;\n    this.peakOffset = Math.min(this.peakOffset, this.peakMaxOffset);\n    this.peakOffset = Math.max(this.peakOffset, this.peakMinOffset);\n    this.draw();\n    this.scrollBarRef.setHandlePosition((this.peakOffset + this.props.count / 2) / (this.peakMaxOffset + this.props.count / 2));\n  }\n\n  prev() {\n    this.peakOffset -= this.props.speed * 10;\n    this.peakOffset = Math.min(this.peakOffset, this.peakMaxOffset);\n    this.peakOffset = Math.max(this.peakOffset, this.peakMinOffset);\n    this.draw();\n    this.scrollBarRef.setHandlePosition((this.peakOffset + this.props.count / 2) / (this.peakMaxOffset + this.props.count / 2));\n  } //Play Loop\n\n\n  update() {\n    this.peakOffset += this.props.speed;\n\n    if (this.peakOffset > this.peakMaxOffset) {\n      this.peakOffset = this.peakMaxOffset;\n      this.stop();\n    }\n\n    if (this.props.onOffsetChanged !== undefined) this.props.onOffsetChanged(this.peakOffset / this.peakMaxOffset);\n    if (this.scrollBarRef != null) this.scrollBarRef.setHandlePosition((this.peakOffset + this.props.count / 2) / (this.peakMaxOffset + this.props.count / 2));\n  }\n\n  draw() {\n    if (this.peakArray[0].length < 2) return;\n    var channelCount = this.props.channels > this.peakArray.length ? this.peakArray.length : this.props.channels;\n    var len = this.props.count < this.peakArray[0].length ? this.props.count : this.peakArray[0].length;\n    var width = this.canvasRef.current.offsetWidth - this.textWidth;\n    var height = this.canvasRef.current.offsetHeight;\n    var halfHeight = this.props.height / 2;\n    var widthStep = width / this.props.count;\n    var startX = widthStep * Math.min(this.peakOffset, 0) * -1 + this.textWidth;\n    var startY = 0;\n    this.canvasContext.strokeStyle = this.props.strokeColor;\n    this.canvasContext.fillStyle = 'black';\n    this.canvasContext.fillRect(0, 0, width + this.textWidth, height); //this.canvasContext.clearRect(0, 0, width, height);\n\n    var currentIdx = 0;\n    var x = 0;\n    var y = 0;\n    this.canvasContext.fillStyle = 'white';\n    this.canvasContext.lineWidth = 1;\n    this.canvasContext.beginPath(); //Draw timeline text\n\n    var currentTime = 0;\n    var i = 0;\n\n    if (this.currentFile) {\n      for (i = 0; i < len; i++) {\n        currentIdx = Math.max(i + this.peakOffset, i);\n        currentTime = currentIdx / this.currentFile.sampleRate;\n        currentTime = Math.floor(currentTime * 10) * 0.1;\n\n        if (currentIdx % (this.currentFile.sampleRate / 10) == 0) {\n          this.canvasContext.fillText(currentTime.toString(), startX + i * widthStep, this.timelineHeight * 0.5);\n        }\n      }\n    }\n\n    for (var c = 0; c < channelCount; c++) {\n      startY = halfHeight * (c * 2 + 1) + this.props.margin * c + this.timelineHeight; //Draw channel text\n\n      this.canvasContext.fillText('channel_' + (c + 1), 0, startY + halfHeight / 2);\n      this.canvasContext.moveTo(startX, this.peakArray[c][Math.max(this.peakOffset, 0)] * halfHeight + startY); //Draw graph\n\n      for (i = 1; i < len; i++) {\n        currentIdx = Math.max(i + this.peakOffset, i);\n        if (currentIdx > this.peakArray[c].length) continue;\n        x = widthStep * i + startX + 0.1;\n        y = this.peakArray[c][currentIdx] * halfHeight + startY + 0.1;\n        this.canvasContext.lineTo(x, y);\n      }\n    }\n\n    this.canvasContext.stroke();\n    this.canvasContext.beginPath();\n    this.canvasContext.strokeStyle = 'red';\n    this.canvasContext.lineWidth = 0.5;\n    this.canvasContext.moveTo(width / 2 + this.textWidth, 0);\n    this.canvasContext.lineTo(width / 2 + this.textWidth, height);\n\n    for (var c = 0; c < channelCount; c++) {\n      this.canvasContext.moveTo(this.textWidth, c * (this.props.height + this.props.margin) + this.timelineHeight);\n      this.canvasContext.lineTo(this.textWidth + width, c * (this.props.height + this.props.margin) + this.timelineHeight);\n      this.canvasContext.moveTo(this.textWidth, c * (this.props.height + this.props.margin) + this.props.height + this.timelineHeight);\n      this.canvasContext.lineTo(this.textWidth + width, c * (this.props.height + this.props.margin) + this.props.height + this.timelineHeight);\n    }\n\n    this.canvasContext.stroke();\n  }\n\n  getCanvas() {\n    return this.canvasRef.current;\n  }\n\n  render() {\n    var style = {\n      display: 'flex',\n      flexDirection: 'column'\n    };\n    this.peakMaxOffset = this.peakArray[0].length - this.props.count / 2;\n    this.peakMinOffset = this.props.count / -2;\n\n    if (this.canvasRef.current != null) {\n      this.draw();\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: style,\n      children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: this.canvasRef,\n        width: this.props.width,\n        height: this.props.channels * (this.props.height + this.props.margin) + this.timelineHeight\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(ScrollBar, {\n        ref: ref => {\n          this.scrollBarRef = ref;\n        },\n        width: this.props.width,\n        height: \"20\",\n        handleWidth: this.props.count / (this.peakArray[0].length + this.props.count / 2),\n        onDragStart: this.stop,\n        onDrag: this.setoffset\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 9\n    }, this);\n  }\n\n}\n\nexport default CanvasGraph;","map":{"version":3,"sources":["C:/Users/tank6/Desktop/React/brainwave_webviewer/src/pages/CanvasGraph.js"],"names":["React","ScrollBar","CanvasGraph","Component","constructor","props","canvasRef","createRef","canvasContext","scrollBarRef","isPlaying","textWidth","timelineHeight","play","bind","stop","setoffset","channelCount","channels","peakArray","peakOffset","count","peakMaxOffset","peakMinOffset","c","i","push","length","componentDidMount","current","getContext","alpha","fillStyle","lineWidth","shadowBlur","font","height","componentWillUnmount","timer","setInterval","update","draw","onPlayStateChanged","undefined","clearInterval","togglePlay","setfile","file","currentFile","getNormalizedAmpData","setHandlePosition","onOffsetChanged","pos","Math","floor","next","speed","min","max","prev","len","width","offsetWidth","offsetHeight","halfHeight","widthStep","startX","startY","strokeStyle","strokeColor","fillRect","currentIdx","x","y","beginPath","currentTime","sampleRate","fillText","toString","margin","moveTo","lineTo","stroke","getCanvas","render","style","display","flexDirection","ref"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport ScrollBar from './ScrollBar';\r\n\r\nclass CanvasGraph extends React.Component{\r\n    constructor(props){\r\n        super(props);\r\n        this.canvasRef = React.createRef();\r\n        this.canvasContext = null;\r\n        this.scrollBarRef = null;\r\n        this.isPlaying = false;\r\n        this.textWidth = 100;\r\n        this.timelineHeight = 50;\r\n\r\n        //Bind Functions\r\n        this.play = this.play.bind(this);\r\n        this.stop = this.stop.bind(this);\r\n        this.setoffset = this.setoffset.bind(this);\r\n\r\n        var channelCount = props.channels;\r\n        this.peakArray = [];\r\n        this.peakOffset = props.count / -2;\r\n        this.peakMaxOffset = 0;\r\n        this.peakMinOffset = props.count / -2;\r\n\r\n        //Create Test Samples\r\n        var c;\r\n        var i;\r\n        for (c = 0; c < channelCount; c++){\r\n            this.peakArray.push([]);\r\n\r\n            for (i = 0; i < 100000; i++){\r\n                this.peakArray[c].push(0);\r\n            }\r\n        }\r\n\r\n        this.peakMaxOffset = this.peakArray[0].length - this.props.count / 2;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.canvasContext = this.canvasRef.current.getContext('2d', {alpha: false});\r\n        this.canvasContext.fillStyle = 'black';\r\n        this.canvasContext.lineWidth = 1;\r\n        this.canvasContext.shadowBlur = 0;\r\n\r\n        this.canvasContext.font = (this.props.height / 2) + 'px malgun gothic';\r\n        this.play();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.stop();\r\n    }\r\n\r\n    //Play\r\n    play (){\r\n        if (this.isPlaying)\r\n            return;\r\n\r\n        //Rewind\r\n        if (this.peakOffset === this.peakMaxOffset){\r\n            this.peakOffset = this.peakMinOffset;\r\n        }\r\n        \r\n        this.timer = setInterval(()=>{this.update(); this.draw();}, 5);\r\n        this.isPlaying = true;\r\n\r\n        if (this.props.onPlayStateChanged !== undefined)\r\n            this.props.onPlayStateChanged();\r\n    }\r\n    \r\n    stop(){\r\n        if (!this.isPlaying)\r\n            return;\r\n\r\n        if (this.timer == null)\r\n            return;\r\n\r\n        clearInterval(this.timer);\r\n        this.timer = null;\r\n        this.isPlaying = false;\r\n\r\n        if (this.props.onPlayStateChanged !== undefined)\r\n            this.props.onPlayStateChanged();\r\n    }\r\n\r\n    togglePlay (){\r\n        if (this.isPlaying)\r\n            this.stop();\r\n        else\r\n            this.play();\r\n    }\r\n    \r\n    //Controls\r\n    setfile(file){\r\n        this.currentFile = file;\r\n        this.peakArray = file.getNormalizedAmpData();\r\n        this.peakOffset = this.peakMinOffset;\r\n        this.peakMaxOffset = this.peakArray[0].length - this.props.count / 2;\r\n\r\n        this.scrollBarRef.setHandlePosition(0);\r\n        this.draw();\r\n\r\n        if (this.props.onOffsetChanged !== undefined)\r\n            this.props.onOffsetChanged(0);\r\n    }\r\n\r\n    setoffset(pos){\r\n        this.peakOffset = Math.floor((this.peakMaxOffset + (this.props.count / 2)) * pos) - (this.props.count / 2);\r\n        this.draw();\r\n\r\n        if (this.props.onOffsetChanged !== undefined)\r\n            this.props.onOffsetChanged(pos);\r\n    }\r\n\r\n    next(){\r\n        this.peakOffset += this.props.speed * 10;\r\n        this.peakOffset = Math.min(this.peakOffset, this.peakMaxOffset);\r\n        this.peakOffset = Math.max(this.peakOffset, this.peakMinOffset);\r\n\r\n        this.draw();\r\n        this.scrollBarRef.setHandlePosition((this.peakOffset + (this.props.count / 2)) / (this.peakMaxOffset + (this.props.count / 2)));\r\n    }\r\n\r\n    prev(){\r\n        this.peakOffset -= this.props.speed * 10;\r\n        this.peakOffset = Math.min(this.peakOffset, this.peakMaxOffset);\r\n        this.peakOffset = Math.max(this.peakOffset, this.peakMinOffset);\r\n\r\n        this.draw();\r\n        this.scrollBarRef.setHandlePosition((this.peakOffset + (this.props.count / 2)) / (this.peakMaxOffset + (this.props.count / 2)));\r\n    }\r\n\r\n    //Play Loop\r\n    update (){\r\n        this.peakOffset += this.props.speed;\r\n\r\n        if (this.peakOffset > this.peakMaxOffset){\r\n            this.peakOffset = this.peakMaxOffset;\r\n            this.stop();\r\n        }\r\n\r\n        if (this.props.onOffsetChanged !== undefined)\r\n            this.props.onOffsetChanged(this.peakOffset / this.peakMaxOffset);\r\n\r\n        if (this.scrollBarRef != null)\r\n            this.scrollBarRef.setHandlePosition((this.peakOffset + (this.props.count / 2)) / (this.peakMaxOffset + (this.props.count / 2)));\r\n    }\r\n\r\n    draw (){\r\n        if (this.peakArray[0].length < 2)\r\n            return;\r\n        \r\n        var channelCount = this.props.channels > this.peakArray.length ? this.peakArray.length : this.props.channels;\r\n\r\n        var len = this.props.count < this.peakArray[0].length ? this.props.count : this.peakArray[0].length;\r\n        var width = this.canvasRef.current.offsetWidth - this.textWidth;\r\n        var height = this.canvasRef.current.offsetHeight;\r\n        var halfHeight = this.props.height / 2;\r\n        var widthStep = width / this.props.count;\r\n\r\n        var startX = widthStep * Math.min(this.peakOffset, 0) * -1 + this.textWidth;\r\n        var startY = 0;\r\n        \r\n        this.canvasContext.strokeStyle = this.props.strokeColor;\r\n        this.canvasContext.fillStyle = 'black';\r\n        this.canvasContext.fillRect(0, 0, width + this.textWidth, height);\r\n        //this.canvasContext.clearRect(0, 0, width, height);\r\n\r\n        var currentIdx = 0;\r\n        var x = 0;\r\n        var y = 0;\r\n\r\n        this.canvasContext.fillStyle = 'white';\r\n        this.canvasContext.lineWidth = 1;\r\n\r\n        this.canvasContext.beginPath();\r\n\r\n        //Draw timeline text\r\n        var currentTime = 0;\r\n        var i = 0;\r\n\r\n        if (this.currentFile){\r\n            for (i = 0; i < len; i++){\r\n                currentIdx = Math.max(i + this.peakOffset, i);\r\n                currentTime = currentIdx / this.currentFile.sampleRate;\r\n                currentTime = Math.floor(currentTime * 10) * 0.1;\r\n\r\n                if (currentIdx % (this.currentFile.sampleRate / 10) == 0){\r\n                    this.canvasContext.fillText(currentTime.toString(), startX + (i * widthStep), this.timelineHeight * 0.5);\r\n                }\r\n            }\r\n        }\r\n\r\n        for (var c = 0; c < channelCount; c++){\r\n            startY = halfHeight * (c * 2 + 1) + (this.props.margin * c) + this.timelineHeight;\r\n            \r\n            //Draw channel text\r\n            this.canvasContext.fillText('channel_' + (c + 1), 0, startY + (halfHeight / 2));\r\n            this.canvasContext.moveTo(startX, (this.peakArray[c][Math.max(this.peakOffset, 0)] * halfHeight) + startY);\r\n\r\n            //Draw graph\r\n            for(i = 1; i < len; i++){\r\n                currentIdx = Math.max(i + this.peakOffset, i);\r\n                if (currentIdx > this.peakArray[c].length)\r\n                    continue;\r\n\r\n                x = (widthStep * i) + startX + 0.1;\r\n                y = (this.peakArray[c][currentIdx] * halfHeight) + startY + 0.1;\r\n                this.canvasContext.lineTo(x, y);\r\n            }\r\n        }\r\n        this.canvasContext.stroke();\r\n        \r\n        this.canvasContext.beginPath();\r\n        this.canvasContext.strokeStyle = 'red';\r\n        this.canvasContext.lineWidth = 0.5;\r\n        this.canvasContext.moveTo(width / 2 + this.textWidth, 0);\r\n        this.canvasContext.lineTo (width / 2 + this.textWidth, height);\r\n        for (var c = 0; c < channelCount; c++){\r\n            this.canvasContext.moveTo(this.textWidth, c * (this.props.height + this.props.margin) + this.timelineHeight);\r\n            this.canvasContext.lineTo(this.textWidth + width, c * (this.props.height + this.props.margin) + this.timelineHeight);\r\n            this.canvasContext.moveTo(this.textWidth, c * (this.props.height + this.props.margin) + this.props.height + this.timelineHeight);\r\n            this.canvasContext.lineTo(this.textWidth + width, c * (this.props.height + this.props.margin) + this.props.height + this.timelineHeight);\r\n        }\r\n        this.canvasContext.stroke();\r\n    }\r\n\r\n    getCanvas(){\r\n        return this.canvasRef.current;\r\n    }\r\n\r\n    render(){\r\n        var style={\r\n            display: 'flex',\r\n            flexDirection: 'column'\r\n        };\r\n        \r\n        this.peakMaxOffset = this.peakArray[0].length - this.props.count / 2;\r\n        this.peakMinOffset = this.props.count / -2;\r\n\r\n        if (this.canvasRef.current != null){\r\n            this.draw();\r\n        }\r\n\r\n        return (\r\n        <div style={style}>\r\n            <canvas ref={this.canvasRef} \r\n            width={this.props.width} height={this.props.channels * (this.props.height + this.props.margin) + this.timelineHeight}/>\r\n            <ScrollBar ref={ref=>{this.scrollBarRef = ref;}}\r\n            width={this.props.width} height='20'\r\n            handleWidth={this.props.count / (this.peakArray[0].length + this.props.count / 2)}\r\n            onDragStart={this.stop}\r\n            onDrag={this.setoffset}/>\r\n        </div>);\r\n    }\r\n}\r\n\r\nexport default CanvasGraph;"]},"metadata":{},"sourceType":"module"}